#!/bin/bash

## check input for given network interface
if [ -z $1 ]; then
  echo "$0 <network_interface>";
  exit
fi

interface=$1
vmName="MikroTik_Environement"

#ImgVersion="6.41.3"   ## long term version
#ImgVersion="6.45.8"   ## long term version
#ImgVersion="6.46.4"    ## stable release
ImgVersion="7.0beta5" ## beta


## Create Install Directory
rm -rf mk_env
mkdir -p mk_env
cd mk_env
path=$(pwd)

## Install Requirements
sudo apt-get update;
sudo apt-get install -y smbclient virtualbox


## Remove VM From Previous Run
if VBoxManage list vms | grep $vmName; then
  echo "Found $vmName - delete it!"
  VBoxManage unregistervm  $vmName --delete --force
  rm -rf $pa/$vmName
  sleep 4
  exit
fi

## Download MikroTik RouterOs
wget https://download.mikrotik.com/routeros/$ImgVersion/chr-$ImgVersion.vmdk -O "$pa/routerOs.vmdk"


## Start RouterOs
VBoxManage createvm --name $vmName --ostype "Debian_64" --register --basefolder "$pa"
VBoxManage modifyvm $vmName --ioapic on
VBoxManage modifyvm $vmName --memory 1024 --vram 128
VBoxManage modifyvm $vmName --nic1 bridged --bridgeadapter1 $interface
VBoxManage storagectl $vmName --name "SATA" --add sata --controller IntelAhci
VBoxManage storageattach $vmName --storagectl "SATA" --port 0 --device 0 --type hdd --medium "$pa/routerOs.vmdk"

VBoxManage startvm $vmName



