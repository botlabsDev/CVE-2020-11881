# CVE-2020-11881 
## MikroTik SMB Remote Denial of Service (DoS)

This report describes CVE-11881, an unauthenticated remote DoS for MikroTik's SMB service running on routerOs.
The vulnerability allows an attacker to crash the running SMB service and was 
responsible disclosed to [security@mikrotik.com](mailto:security@mikrotik.com) on 06.04.2020.

The Server Message Block (SMB) protocol was introduced by Microsoft and reimplemented by multiple vendors in order to 
maintain file exchange compatibility to Windows systems and services. 
The protocol in general is used for file exchange between Windows systems.

## Affected Versions

- 6.41.3 (long term release)
- 6.45.8 (long term release)
- 6.46.4 
- 7.0beta5 and below


## The SMB Vulnerability
The SMB server will crash after receiving a `negotiation-request` packet followed by a modified `setup-request` packet. 
In order to trigger the vulnerability, the `setup-request` packet needs to have the MessageID field set to 1 and the 
SessionID field set to 0. The service crashes since it apparently can't handle the SessionID field.


## Reproducing the Bug
In order to reliably reproduce the bug, please rebuild the used test environment provided in this repo. 

   1. Download and start the routerOs environment. 
   
        Please execute the following script on a fresh installed version of 
        Ubuntu 18.04, since the script will install all required files. 
        Please notice, that the used __network interface__ needs to be given to the script.
        
        ```bash
        sudo ./setupMikroTikEnvironment.sh <networkInterface>
        ```
   2. Enable SMB on routerOs
   
        Determine the IP address of the executed VM and run the following commands to 
        activate the SMB service.
              
        ```bash
        telnet <RouterOs IP> 
        (user: admin, <no password>)
        ip smb set enabled=yes
        ip smb print
        ```
        The service can be checked manually from the host system with the following command and should respond
        wiht `Anonymous login successful`
        
        ```bash
        smbclient -N -L \\\\<RouterOs IP>
        ```
       
   3. The denial of service attack
   
        The python3 script `cve-2020-11881.py` validates the availability of the SMB service before and after the 
        exploitation process. A successful execution will end up with the unavailability of the SMB service.
        Please execute the script as shown below.
        
        ```python
        python3 cve-2020-11881.py --ip <RouterOs Ip>
        ```

## Fix

CVE-2020-11881 has been fixed from version 6.47beta66 and 6.47 and was added to the next followed long term version.

---
[Thanks.for.reading@Botlabs.dev](mailto:Thanks.for.reading@Botlabs.dev) 
